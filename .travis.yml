language: go
sudo: false
matrix:
  include:
    - go: 1.x
      env: LATEST=true
    - go: 1.7.x
    - go: 1.8.x
    - go: 1.9.x
    - go: 1.10.x
    - go: 1.11.x
    - go: tip
  allow_failures:
    - go: tip

before_install:
    - go get github.com/mitchellh/gox
    - go get -t -v ./...

install:
    - # skip

script:
    - go get -t -v ./...
    - diff -u <(echo -n) <(gofmt -d .)
    - go vet $(go list ./... | grep -v /vendor/)
    - go test -v -race ./...
    # Only build binaries from the latest Go release.
    - if [ "${LATEST}" = "true" ]; then gox -os="linux darwin windows freebsd" -arch="386 amd64 arm arm64" -verbose ./...; fi

notifications:
    email: false
